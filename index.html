<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <!-- A-Frame core library -->
        <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

        <!-- Load AR.js library for A-Frame -->
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

        <!-- Look-at component -->
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    </head>
    <body>
        <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
            <a-marker preset="hiro">
                <a-entity
                    id="earthRunestone"
                    gltf-model="assets/earth/earth-runestone.glb"
                    rotation="-90 0 0"
                    scale="1 1 1"
                    class="clickable">
                    <!-- "Tap to Start" prompt -->
                    <a-image
                        id="tapToStart1"
                        src="assets/tap-to-start.svg"
                        position="0 1.5 0"
                        width="1"
                        height="1"
                        look-at="[camera]"></a-image>
                </a-entity>
            </a-marker>

            <a-marker preset="kanji">
                <a-entity rotation="-90 0 0">
                    <a-entity
                        id="waterRunestone"
                        gltf-model="assets/water/water-runestone.glb"
                        rotation="0 -90 0"
                        scale="1 1 1"
                        class="clickable">
                        <!-- "Tap to Start" prompt -->
                        <a-image
                            id="tapToStart2"
                            src="assets/tap-to-start.svg"
                            position="0 1.5 0"
                            width="1"
                            height="1"
                            look-at="[camera]"></a-image>
                    </a-entity>
                </a-entity>
            </a-marker>

            <a-marker type="pattern" url="assets/patterns/triangle-pattern.patt">
                <a-entity rotation="-90 0 0">
                    <a-entity
                        id="fireRunestone"
                        gltf-model="assets/fire/fire-runestone.glb"
                        rotation="0 90 0"
                        scale="1 1 1"
                        class="clickable">
                        <!-- "Tap to Start" prompt -->
                        <a-image
                            id="tapToStart3"
                            src="assets/tap-to-start.svg"
                            position="0 1.5 0"
                            width="1"
                            height="1"
                            look-at="[camera]"></a-image>
                    </a-entity>
                </a-entity>
            </a-marker>

            <a-marker type="pattern" url="assets/patterns/star-pattern.patt">
                <a-entity rotation="-90 0 0">
                    <a-entity
                        id="airRunestone"
                        gltf-model="assets/air/air-runestone.glb"
                        rotation="0 -90 0"
                        scale="1 1 1"
                        class="clickable">
                        <!-- "Tap to Start" prompt -->
                        <a-image
                            id="tapToStart4"
                            src="assets/tap-to-start.svg"
                            position="0 1.5 0"
                            width="1"
                            height="1"
                            look-at="[camera]"></a-image>
                    </a-entity>
                </a-entity>
            </a-marker>

            <a-marker type="pattern" url="assets/patterns/l-pattern.patt">
                <a-entity
                    id="koppieOrb"
                    gltf-model="assets/koppie/spirit-of-the-koppie-orb.glb"
                    rotation="-90 0 0"
                    scale="1 1 1"
                    class="clickable">
                    <!-- "Tap to Start" prompt -->
                    <a-image
                        id="tapToStart5"
                        src="assets/tap-to-start.svg"
                        position="0 1.5 0"
                        width="1"
                        height="1"
                        look-at="[camera]"></a-image>
                </a-entity>
            </a-marker>

            <a-entity camera cursor="fuse: false; rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
        </a-scene>

        <!-- HTML audio element for the guardian's theme music -->
        <audio
            id="earthGuardianAudio"
            src="assets/earth/earth-guardian-theme.mp3"
            preload="auto"
            crossorigin="anonymous"></audio>
        <audio
            id="waterGuardianAudio"
            src="assets/water/water-guardian-theme.mp3"
            preload="auto"
            crossorigin="anonymous"></audio>
        <audio
            id="fireGuardianAudio"
            src="assets/fire/fire-guardian-theme.mp3"
            preload="auto"
            crossorigin="anonymous"></audio>
        <audio id="airGuardianAudio" src="assets/air/air-guardian-theme.mp3" preload="auto" crossorigin="anonymous"></audio>
        <audio
            id="koppieAudio"
            src="assets/koppie/spirit-of-the-koppie-theme.mp3"
            preload="auto"
            crossorigin="anonymous"></audio>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Unlock audio context
                const audios = document.querySelectorAll("audio");

                function unlockAudio() {
                    audios.forEach((a) => {
                        a.play()
                            .then(() => a.pause())
                            .catch(() => {});
                    });
                    document.removeEventListener("click", unlockAudio);
                    document.removeEventListener("touchstart", unlockAudio);
                    console.log("ðŸ”“ Audio context unlocked!");
                }

                document.addEventListener("click", unlockAudio);
                document.addEventListener("touchstart", unlockAudio);
            });
            // Wait for the A-Frame scene to finish loading
            document.querySelector("a-scene").addEventListener("loaded", function () {
                // Get references to the model, tap image, and audio elements
                const earthRunestone = document.querySelector("#earthRunestone");
                const earthTapImage = earthRunestone.querySelector("#tapToStart1");
                const earthSound = document.querySelector("#earthGuardianAudio");
                const earthMarker = earthRunestone.closest("a-marker"); // NEW LINE

                // Get references to the model, tap image, and audio elements
                const waterRunestone = document.querySelector("#waterRunestone");
                const waterTapImage = waterRunestone.querySelector("#tapToStart2");
                const waterSound = document.querySelector("#waterGuardianAudio");
                const waterMarker = waterRunestone.closest("a-marker"); // NEW LINE

                // Get references to the model, tap image, and audio elements
                const fireRunestone = document.querySelector("#fireRunestone");
                const fireTapImage = fireRunestone.querySelector("#tapToStart3");
                const fireSound = document.querySelector("#fireGuardianAudio");
                const fireMarker = fireRunestone.closest("a-marker"); // NEW LINE

                // Get references to the model, tap image, and audio elements
                const airRunestone = document.querySelector("#airRunestone");
                const airTapImage = airRunestone.querySelector("#tapToStart4");
                const airSound = document.querySelector("#airGuardianAudio");
                const airMarker = airRunestone.closest("a-marker"); // NEW LINE

                // Get references to the model, tap image, and audio elements
                const koppieOrb = document.querySelector("#koppieOrb");
                const koppieTapImage = koppieOrb.querySelector("#tapToStart5");
                const koppieSound = document.querySelector("#koppieAudio");
                const koppieMarker = koppieOrb.closest("a-marker"); // NEW LINE

                // Add a click event listener to the model
                earthRunestone.addEventListener("click", (e) => {
                    // Swap the runestone model with the guardian model
                    earthRunestone.setAttribute("gltf-model", "assets/earth/earth-guardian.glb");
                    earthRunestone.setAttribute("scale", "3 3 3");
                    earthRunestone.setAttribute("animation-mixer", "");

                    // Hide the "Tap to Start" prompt
                    earthTapImage.setAttribute("visible", "false");

                    // Play the guardian's theme music
                    earthSound.play();
                });

                // NEW BLOCK
                earthMarker.addEventListener("markerLost", () => {
                    earthSound.pause();
                    earthSound.currentTime = 0;
                });

                // Add a click event listener to the model
                waterRunestone.addEventListener("click", (e) => {
                    // Swap the runestone model with the guardian model
                    waterRunestone.setAttribute("gltf-model", "assets/water/water-guardian.glb");
                    waterRunestone.setAttribute("scale", "3 3 3");
                    waterRunestone.setAttribute("animation-mixer", "");
                    waterRunestone.setAttribute("rotation", "0 0 0");

                    // Hide the "Tap to Start" prompt
                    waterTapImage.setAttribute("visible", "false");

                    // Play the guardian's theme music
                    waterSound.play();
                });

                // NEW BLOCK
                waterMarker.addEventListener("markerLost", () => {
                    waterSound.pause();
                    waterSound.currentTime = 0;
                });

                // Add a click event listener to the model
                fireRunestone.addEventListener("click", (e) => {
                    // Swap the runestone model with the guardian model
                    fireRunestone.setAttribute("gltf-model", "assets/fire/fire-guardian.glb");
                    fireRunestone.setAttribute("scale", "3 3 3");
                    fireRunestone.setAttribute("animation-mixer", "");
                    fireRunestone.setAttribute("rotation", "0 0 0");

                    // Hide the "Tap to Start" prompt
                    fireTapImage.setAttribute("visible", "false");

                    // Play the guardian's theme music
                    fireSound.play();
                });

                // NEW BLOCK
                fireMarker.addEventListener("markerLost", () => {
                    fireSound.pause();
                    fireSound.currentTime = 0;
                });

                // Add a click event listener to the model
                airRunestone.addEventListener("click", (e) => {
                    // Swap the runestone model with the guardian model
                    airRunestone.setAttribute("gltf-model", "assets/air/air-guardian.glb");
                    airRunestone.setAttribute("scale", "3 3 3");
                    airRunestone.setAttribute("animation-mixer", "");
                    airRunestone.setAttribute("rotation", "0 0 0");

                    // Hide the "Tap to Start" prompt
                    airTapImage.setAttribute("visible", "false");

                    // Play the guardian's theme music
                    airSound.play();
                });

                // NEW BLOCK
                airMarker.addEventListener("markerLost", () => {
                    airSound.pause();
                    airSound.currentTime = 0;
                });

                // Add a click event listener to the model
                koppieOrb.addEventListener("click", (e) => {
                    // Swap the runestone model with the guardian model
                    koppieOrb.setAttribute("gltf-model", "assets/koppie/spirit-of-the-koppie.glb");
                    koppieOrb.setAttribute("scale", "3 3 3");
                    koppieOrb.setAttribute("animation-mixer", "");

                    // Hide the "Tap to Start" prompt
                    koppieTapImage.setAttribute("visible", "false");

                    // Play the guardian's theme music
                    koppieSound.play();
                });

                // NEW BLOCK
                koppieMarker.addEventListener("markerLost", () => {
                    koppieSound.pause();
                    koppieSound.currentTime = 0;
                });
            });
        </script>
    </body>
</html>
